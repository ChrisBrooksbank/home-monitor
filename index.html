<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>üè† 28 Barn Green - Home Monitor</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Home monitoring dashboard for 28 Barn Green">
    <meta name="theme-color" content="#87CEEB">
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Home Monitor">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Clouds -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>

    <!-- Birds -->
    <div class="bird bird1">üê¶</div>
    <div class="bird bird2">üïäÔ∏è</div>

    <div class="container">
        <div class="header-row">
            <h1>üè° 28 Barn Green üå°Ô∏è</h1>
            <div class="header-controls">
                <div class="connection-status" id="connectionStatus" title="Connection status">
                    <span class="status-indicator" id="status-hue" data-service="hue">
                        <span class="status-dot"></span>
                        <span class="status-name">Hue</span>
                    </span>
                    <span class="status-divider">|</span>
                    <span class="status-indicator" id="status-sonos" data-service="sonos">
                        <span class="status-dot"></span>
                        <span class="status-name">Sonos</span>
                    </span>
                    <span class="status-indicator" id="status-tapo" data-service="tapo">
                        <span class="status-dot"></span>
                        <span class="status-name">Tapo</span>
                    </span>
                    <span class="status-indicator" id="status-shield" data-service="shield">
                        <span class="status-dot"></span>
                        <span class="status-name">SHIELD</span>
                    </span>
                </div>
                <button id="viewModeToggle" class="view-toggle" onclick="toggleViewMode()" title="Toggle between Simple and Full view">
                    <span class="toggle-icon">üëÅÔ∏è</span>
                    <span class="toggle-label" id="viewModeLabel">Full</span>
                </button>
            </div>
        </div>
        <div class="last-update" id="lastUpdate">Loading magical temperatures...</div>

        <div class="house-container">
            <svg viewBox="0 0 1000 650" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <!-- Gradients -->
                    <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#E0F6FF;stop-opacity:0.1" />
                    </linearGradient>

                    <linearGradient id="roofGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#C92A2A;stop-opacity:1" />
                    </linearGradient>

                    <linearGradient id="wallGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFE66D;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFC93C;stop-opacity:1" />
                    </linearGradient>

                    <linearGradient id="grassGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#7AE582;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#4CAF50;stop-opacity:1" />
                    </linearGradient>

                    <!-- Nest Thermostat metallic gradient (Polished Silver) -->
                    <radialGradient id="nestMetalGradient" cx="30%" cy="30%">
                        <stop offset="0%" style="stop-color:#F5F5F5;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#D3D3D3;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#A8A8A8;stop-opacity:1" />
                    </radialGradient>

                    <!-- Room gradients - temperature based -->
                    <linearGradient id="coldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#A8DADC;stop-opacity:0.9" />
                        <stop offset="100%" style="stop-color:#1D3557;stop-opacity:0.9" />
                    </linearGradient>

                    <linearGradient id="coolGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#B8F2E6;stop-opacity:0.9" />
                        <stop offset="100%" style="stop-color:#5FA9A1;stop-opacity:0.9" />
                    </linearGradient>

                    <linearGradient id="warmGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD6A5;stop-opacity:0.9" />
                        <stop offset="100%" style="stop-color:#FFADAD;stop-opacity:0.9" />
                    </linearGradient>

                    <linearGradient id="hotGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FF9999;stop-opacity:0.9" />
                        <stop offset="100%" style="stop-color:#FF6B6B;stop-opacity:0.9" />
                    </linearGradient>

                    <!-- Patterns -->
                    <pattern id="brickPattern" x="0" y="0" width="40" height="20" patternUnits="userSpaceOnUse">
                        <rect width="40" height="20" fill="none"/>
                        <rect width="18" height="8" x="1" y="1" fill="rgba(200,100,100,0.3)" stroke="rgba(150,50,50,0.4)" stroke-width="0.5"/>
                        <rect width="18" height="8" x="21" y="11" fill="rgba(200,100,100,0.3)" stroke="rgba(150,50,50,0.4)" stroke-width="0.5"/>
                    </pattern>

                    <filter id="shadow">
                        <feDropShadow dx="0" dy="6" stdDeviation="8" flood-opacity="0.4"/>
                    </filter>

                    <filter id="glow">
                        <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>

                <!-- Sky background -->
                <rect width="1000" height="600" fill="url(#skyGradient)"/>

                <!-- Weather Info Panel (Top Right) -->
                <g id="weather-info-panel" transform="translate(800, 30)">
                    <!-- Semi-transparent background -->
                    <rect x="0" y="0" width="180" height="110" rx="15" fill="rgba(255, 255, 255, 0.85)" stroke="rgba(100, 100, 100, 0.3)" stroke-width="2"/>

                    <!-- Weather Icon -->
                    <image id="weather-icon-svg" x="10" y="10" width="50" height="50" href=""/>

                    <!-- Temperature -->
                    <text id="weather-temp-svg" x="70" y="35" font-size="28" font-weight="bold" fill="#333" font-family="Arial">--¬∞</text>

                    <!-- Condition -->
                    <text id="weather-condition-svg" x="70" y="52" font-size="11" fill="#666" font-family="Arial">Loading...</text>

                    <!-- Feels Like -->
                    <text id="weather-feels-svg" x="10" y="75" font-size="10" fill="#555" font-family="Arial">Feels: --¬∞</text>

                    <!-- Humidity & UV -->
                    <text id="weather-humidity-svg" x="10" y="90" font-size="9" fill="#555" font-family="Arial">üíß --%</text>
                    <text id="weather-uv-svg" x="10" y="103" font-size="9" fill="#555" font-family="Arial">‚òÄÔ∏è UV -</text>

                    <!-- Wind -->
                    <text id="weather-wind-svg" x="100" y="75" font-size="9" fill="#555" font-family="Arial">üå¨Ô∏è -- km/h</text>
                    <text id="weather-wind-dir-svg" x="100" y="88" font-size="9" fill="#555" font-family="Arial">--</text>
                </g>

                <!-- Sun -->
                <g id="sun" style="animation: spin 30s linear infinite; transform-origin: 880px 100px;">
                    <circle cx="880" cy="100" r="50" fill="#FFD700" opacity="0.8" filter="url(#glow)"/>
                    <circle cx="880" cy="100" r="40" fill="#FFA500"/>
                </g>

                <!-- Moon (hidden during day) -->
                <g id="moon" style="display: none;">
                    <circle cx="850" cy="120" r="45" fill="#F0F0F0" filter="url(#glow)"/>
                    <circle cx="860" cy="115" r="40" fill="#E8E8E8"/>
                    <!-- Craters -->
                    <circle cx="845" cy="110" r="8" fill="#D0D0D0" opacity="0.6"/>
                    <circle cx="870" cy="125" r="6" fill="#D0D0D0" opacity="0.5"/>
                    <circle cx="855" cy="135" r="5" fill="#D0D0D0" opacity="0.7"/>
                </g>

                <!-- Stars (hidden during day) -->
                <g id="stars" style="display: none;">
                    <circle cx="100" cy="50" r="2" fill="white" opacity="0.9">
                        <animate attributeName="opacity" values="0.9;0.3;0.9" dur="3s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="200" cy="80" r="1.5" fill="white" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.4;0.8" dur="2.5s" repeatCount="indefinite" begin="0.5s"/>
                    </circle>
                    <circle cx="350" cy="40" r="2" fill="white" opacity="0.9">
                        <animate attributeName="opacity" values="0.9;0.2;0.9" dur="4s" repeatCount="indefinite" begin="1s"/>
                    </circle>
                    <circle cx="500" cy="70" r="1.5" fill="white" opacity="0.7">
                        <animate attributeName="opacity" values="0.7;0.3;0.7" dur="3.5s" repeatCount="indefinite" begin="1.5s"/>
                    </circle>
                    <circle cx="650" cy="45" r="2" fill="white" opacity="0.9">
                        <animate attributeName="opacity" values="0.9;0.4;0.9" dur="3s" repeatCount="indefinite" begin="0.8s"/>
                    </circle>
                    <circle cx="750" cy="90" r="1.5" fill="white" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="2.8s" repeatCount="indefinite" begin="2s"/>
                    </circle>
                    <circle cx="150" cy="120" r="1" fill="white" opacity="0.7">
                        <animate attributeName="opacity" values="0.7;0.2;0.7" dur="3.2s" repeatCount="indefinite" begin="0.3s"/>
                    </circle>
                    <circle cx="300" cy="110" r="1.5" fill="white" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.4;0.8" dur="3.8s" repeatCount="indefinite" begin="1.2s"/>
                    </circle>
                    <circle cx="450" cy="130" r="1" fill="white" opacity="0.7">
                        <animate attributeName="opacity" values="0.7;0.3;0.7" dur="2.7s" repeatCount="indefinite" begin="1.8s"/>
                    </circle>
                    <circle cx="600" cy="100" r="1.5" fill="white" opacity="0.9">
                        <animate attributeName="opacity" values="0.9;0.3;0.9" dur="3.3s" repeatCount="indefinite" begin="0.6s"/>
                    </circle>
                    <circle cx="800" cy="55" r="2" fill="white" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.2;0.8" dur="4.2s" repeatCount="indefinite" begin="2.5s"/>
                    </circle>
                    <circle cx="920" cy="75" r="1.5" fill="white" opacity="0.9">
                        <animate attributeName="opacity" values="0.9;0.4;0.9" dur="3.6s" repeatCount="indefinite" begin="1.3s"/>
                    </circle>
                </g>

                <!-- Weather Effects -->
                <!-- Rain (hidden by default) -->
                <g id="rain" style="display: none;">
                    <line x1="50" y1="0" x2="48" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="0;600" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="80;680" dur="1s" repeatCount="indefinite"/>
                    </line>
                    <line x1="150" y1="0" x2="148" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="-50;550" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="30;630" dur="1s" repeatCount="indefinite"/>
                    </line>
                    <line x1="250" y1="0" x2="248" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="0;600" dur="0.9s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="80;680" dur="0.9s" repeatCount="indefinite"/>
                    </line>
                    <line x1="350" y1="0" x2="348" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="-30;570" dur="1.1s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="50;650" dur="1.1s" repeatCount="indefinite"/>
                    </line>
                    <line x1="450" y1="0" x2="448" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="0;600" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="80;680" dur="1s" repeatCount="indefinite"/>
                    </line>
                    <line x1="550" y1="0" x2="548" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="-40;560" dur="0.95s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="40;640" dur="0.95s" repeatCount="indefinite"/>
                    </line>
                    <line x1="650" y1="0" x2="648" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="0;600" dur="1.05s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="80;680" dur="1.05s" repeatCount="indefinite"/>
                    </line>
                    <line x1="750" y1="0" x2="748" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="-20;580" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="60;660" dur="1s" repeatCount="indefinite"/>
                    </line>
                    <line x1="850" y1="0" x2="848" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="0;600" dur="0.92s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="80;680" dur="0.92s" repeatCount="indefinite"/>
                    </line>
                    <line x1="950" y1="0" x2="948" y2="80" stroke="#A0C8E0" stroke-width="2" opacity="0.6">
                        <animate attributeName="y1" values="-35;565" dur="1.08s" repeatCount="indefinite"/>
                        <animate attributeName="y2" values="45;645" dur="1.08s" repeatCount="indefinite"/>
                    </line>
                </g>

                <!-- Snow (hidden by default) -->
                <g id="snow" style="display: none;">
                    <circle cx="80" cy="0" r="3" fill="white" opacity="0.9">
                        <animate attributeName="cy" values="0;650" dur="8s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="80;90;75;85;80" dur="8s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="200" cy="0" r="4" fill="white" opacity="0.85">
                        <animate attributeName="cy" values="-50;600" dur="10s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="200;210;195;205;200" dur="10s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="320" cy="0" r="3.5" fill="white" opacity="0.9">
                        <animate attributeName="cy" values="0;650" dur="9s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="320;330;315;325;320" dur="9s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="450" cy="0" r="3" fill="white" opacity="0.88">
                        <animate attributeName="cy" values="-80;570" dur="11s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="450;460;445;455;450" dur="11s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="570" cy="0" r="4" fill="white" opacity="0.9">
                        <animate attributeName="cy" values="0;650" dur="8.5s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="570;580;565;575;570" dur="8.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="690" cy="0" r="3.5" fill="white" opacity="0.87">
                        <animate attributeName="cy" values="-100;550" dur="10.5s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="690;700;685;695;690" dur="10.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="810" cy="0" r="3" fill="white" opacity="0.9">
                        <animate attributeName="cy" values="0;650" dur="9.5s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="810;820;805;815;810" dur="9.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="920" cy="0" r="4" fill="white" opacity="0.86">
                        <animate attributeName="cy" values="-60;590" dur="11.5s" repeatCount="indefinite"/>
                        <animate attributeName="cx" values="920;930;915;925;920" dur="11.5s" repeatCount="indefinite"/>
                    </circle>
                </g>

                <!-- Fog/Mist (hidden by default) -->
                <g id="fog" style="display: none;">
                    <ellipse cx="200" cy="500" rx="300" ry="80" fill="white" opacity="0.3">
                        <animate attributeName="opacity" values="0.3;0.5;0.3" dur="6s" repeatCount="indefinite"/>
                    </ellipse>
                    <ellipse cx="600" cy="480" rx="350" ry="90" fill="white" opacity="0.25">
                        <animate attributeName="opacity" values="0.25;0.45;0.25" dur="7s" repeatCount="indefinite" begin="1s"/>
                    </ellipse>
                    <ellipse cx="400" cy="520" rx="280" ry="70" fill="white" opacity="0.35">
                        <animate attributeName="opacity" values="0.35;0.55;0.35" dur="5.5s" repeatCount="indefinite" begin="2s"/>
                    </ellipse>
                    <ellipse cx="800" cy="510" rx="320" ry="85" fill="white" opacity="0.28">
                        <animate attributeName="opacity" values="0.28;0.48;0.28" dur="6.5s" repeatCount="indefinite" begin="0.5s"/>
                    </ellipse>
                </g>

                <!-- Grass -->
                <ellipse cx="500" cy="620" rx="600" ry="80" fill="url(#grassGradient)"/>
                <ellipse cx="300" cy="595" rx="200" ry="35" fill="#69B578" opacity="0.6"/>
                <ellipse cx="700" cy="605" rx="250" ry="40" fill="#69B578" opacity="0.6"/>

                <!-- Pixel Art UK Semi-Detached House -->
                <g>
                    <!-- Attached neighbor house (left side, partial) -->
                    <rect x="20" y="250" width="80" height="350" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                    <rect x="20" y="250" width="80" height="350" fill="url(#brickPattern)" opacity="0.8"/>

                    <!-- Main house structure - brick exterior -->
                    <rect x="100" y="200" width="800" height="400" fill="#A0522D" stroke="#654321" stroke-width="4"/>

                    <!-- Pixel brick pattern overlay -->
                    <defs>
                        <pattern id="pixelBrick" x="0" y="0" width="32" height="16" patternUnits="userSpaceOnUse">
                            <rect width="32" height="16" fill="#A0522D"/>
                            <rect x="0" y="0" width="15" height="7" fill="#8B4513" stroke="#654321" stroke-width="0.5"/>
                            <rect x="16" y="0" width="15" height="7" fill="#8B4513" stroke="#654321" stroke-width="0.5"/>
                            <rect x="8" y="8" width="15" height="7" fill="#8B4513" stroke="#654321" stroke-width="0.5"/>
                            <rect x="24" y="8" width="7" height="7" fill="#8B4513" stroke="#654321" stroke-width="0.5"/>
                            <rect x="0" y="8" width="7" height="7" fill="#8B4513" stroke="#654321" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <rect x="100" y="200" width="800" height="400" fill="url(#pixelBrick)" opacity="0.6"/>

                    <!-- Pitched roof - pixel style -->
                    <polygon points="80,200 500,80 920,200" fill="#7D0000" stroke="#4A0000" stroke-width="3"/>
                    <!-- Roof tiles effect -->
                    <line x1="500" y1="80" x2="80" y2="200" stroke="#5A0000" stroke-width="2"/>
                    <line x1="500" y1="80" x2="920" y2="200" stroke="#5A0000" stroke-width="2"/>
                    <line x1="290" y1="140" x2="80" y2="200" stroke="#5A0000" stroke-width="1"/>
                    <line x1="710" y1="140" x2="920" y2="200" stroke="#5A0000" stroke-width="1"/>

                    <!-- Chimney stack - pixel style -->
                    <rect x="700" y="100" width="48" height="100" fill="#8B4513" stroke="#654321" stroke-width="2"/>
                    <rect x="700" y="100" width="48" height="100" fill="url(#pixelBrick)" opacity="0.7"/>
                    <rect x="692" y="92" width="64" height="16" fill="#654321"/>

                    <!-- Chimney pots -->
                    <rect x="708" y="76" width="12" height="20" fill="#654321" stroke="#000" stroke-width="1"/>
                    <rect x="728" y="76" width="12" height="20" fill="#654321" stroke="#000" stroke-width="1"/>

                    <!-- Smoke (pixelated) -->
                    <rect x="710" y="60" width="8" height="8" fill="#D3D3D3" opacity="0.5">
                        <animate attributeName="opacity" values="0.5;0.2;0.5" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <rect x="718" y="52" width="8" height="8" fill="#D3D3D3" opacity="0.4">
                        <animate attributeName="opacity" values="0.4;0.1;0.4" dur="2s" repeatCount="indefinite" begin="0.5s"/>
                    </rect>
                    <rect x="730" y="62" width="8" height="8" fill="#D3D3D3" opacity="0.5">
                        <animate attributeName="opacity" values="0.5;0.2;0.5" dur="2s" repeatCount="indefinite" begin="1s"/>
                    </rect>

                    <!-- Pixel art windows on exterior (first floor) -->
                    <g id="exterior-windows-first">
                        <rect x="140" y="240" width="48" height="56" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="164" y1="240" x2="164" y2="296" stroke="#2C1507" stroke-width="2"/>
                        <line x1="140" y1="268" x2="188" y2="268" stroke="#2C1507" stroke-width="2"/>

                        <rect x="300" y="240" width="48" height="56" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="324" y1="240" x2="324" y2="296" stroke="#2C1507" stroke-width="2"/>
                        <line x1="300" y1="268" x2="348" y2="268" stroke="#2C1507" stroke-width="2"/>

                        <rect x="460" y="240" width="48" height="56" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="484" y1="240" x2="484" y2="296" stroke="#2C1507" stroke-width="2"/>
                        <line x1="460" y1="268" x2="508" y2="268" stroke="#2C1507" stroke-width="2"/>

                        <rect x="620" y="240" width="48" height="56" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="644" y1="240" x2="644" y2="296" stroke="#2C1507" stroke-width="2"/>
                        <line x1="620" y1="268" x2="668" y2="268" stroke="#2C1507" stroke-width="2"/>

                        <rect x="780" y="240" width="48" height="56" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="804" y1="240" x2="804" y2="296" stroke="#2C1507" stroke-width="2"/>
                        <line x1="780" y1="268" x2="828" y2="268" stroke="#2C1507" stroke-width="2"/>
                    </g>

                    <!-- Pixel art windows on exterior (ground floor) -->
                    <g id="exterior-windows-ground">
                        <rect x="320" y="420" width="56" height="72" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="348" y1="420" x2="348" y2="492" stroke="#2C1507" stroke-width="2"/>
                        <line x1="320" y1="456" x2="376" y2="456" stroke="#2C1507" stroke-width="2"/>

                        <rect x="520" y="420" width="56" height="72" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="548" y1="420" x2="548" y2="492" stroke="#2C1507" stroke-width="2"/>
                        <line x1="520" y1="456" x2="576" y2="456" stroke="#2C1507" stroke-width="2"/>

                        <rect x="740" y="420" width="56" height="72" fill="#87CEEB" stroke="#2C1507" stroke-width="2"/>
                        <line x1="768" y1="420" x2="768" y2="492" stroke="#2C1507" stroke-width="2"/>
                        <line x1="740" y1="456" x2="796" y2="456" stroke="#2C1507" stroke-width="2"/>
                    </g>

                    <!-- FIRST FLOOR ROOMS (y: 200-350) -->
                    <!-- Main Bedroom (above Hall) -->
                    <rect x="100" y="200" width="160" height="150" fill="rgba(255,182,193,0.5)" stroke="#CC9933" stroke-width="3"/>
                    <text x="180" y="225" text-anchor="middle" font-size="14" font-weight="700" font-family="Fredoka" fill="#8B4513">Main Bedroom</text>

                    <!-- Landing -->
                    <rect x="260" y="200" width="160" height="150" fill="rgba(255,218,185,0.5)" stroke="#CC9933" stroke-width="3"/>
                    <text x="340" y="225" text-anchor="middle" font-size="14" font-weight="700" font-family="Fredoka" fill="#8B4513">Landing</text>
                    <!-- Stairs icon -->
                    <rect x="310" y="260" width="60" height="6" fill="rgba(139,69,19,0.6)"/>
                    <rect x="310" y="270" width="60" height="6" fill="rgba(139,69,19,0.6)"/>
                    <rect x="310" y="280" width="60" height="6" fill="rgba(139,69,19,0.6)"/>
                    <rect x="310" y="290" width="60" height="6" fill="rgba(139,69,19,0.6)"/>

                    <!-- Home Office -->
                    <rect x="420" y="200" width="160" height="150" fill="rgba(173,216,230,0.5)" stroke="#CC9933" stroke-width="3"/>
                    <text x="500" y="225" text-anchor="middle" font-size="14" font-weight="700" font-family="Fredoka" fill="#8B4513">Home Office</text>

                    <!-- Bathroom -->
                    <rect x="580" y="200" width="160" height="150" fill="rgba(152,251,152,0.5)" stroke="#CC9933" stroke-width="3"/>
                    <text x="660" y="225" text-anchor="middle" font-size="14" font-weight="700" font-family="Fredoka" fill="#8B4513">Bathroom</text>

                    <!-- Guest Bedroom -->
                    <rect x="740" y="200" width="160" height="150" fill="rgba(221,160,221,0.5)" stroke="#CC9933" stroke-width="3"/>
                    <text x="820" y="225" text-anchor="middle" font-size="14" font-weight="700" font-family="Fredoka" fill="#8B4513">Guest Bedroom</text>

                    <!-- GROUND FLOOR ROOMS (y: 350-600) -->
                    <!-- Hall (left, with door) -->
                    <rect x="100" y="350" width="200" height="250" fill="rgba(152,216,211,0.5)" stroke="#CC9933" stroke-width="4"/>
                    <text x="200" y="380" text-anchor="middle" font-size="16" font-weight="700" font-family="Fredoka" fill="#8B4513">Hall</text>
                    <!-- Front Door - pixel art style -->
                    <rect x="160" y="500" width="80" height="100" fill="#4A2511" stroke="#2C1507" stroke-width="3"/>
                    <!-- Door panels -->
                    <rect x="168" y="508" width="64" height="40" fill="#5D3116" stroke="#2C1507" stroke-width="1"/>
                    <rect x="168" y="552" width="64" height="40" fill="#5D3116" stroke="#2C1507" stroke-width="1"/>
                    <!-- Door handle -->
                    <circle cx="215" cy="560" r="4" fill="#FFD700" stroke="#CC9900" stroke-width="1"/>
                    <!-- Door letterbox -->
                    <rect x="180" y="530" width="40" height="6" fill="#2C1507"/>

                    <!-- House Number Plaque -->
                    <rect x="125" y="520" width="30" height="35" fill="#F5F5DC" stroke="#8B7355" stroke-width="2" rx="3"/>
                    <text x="140" y="542" text-anchor="middle" font-size="20" font-weight="700" font-family="Georgia, serif" fill="#2C1507">28</text>

                    <!-- Lounge -->
                    <rect x="300" y="350" width="200" height="250" fill="rgba(244,164,96,0.5)" stroke="#CC9933" stroke-width="4"/>
                    <text x="400" y="380" text-anchor="middle" font-size="16" font-weight="700" font-family="Fredoka" fill="#8B4513">Lounge</text>

                    <!-- Nest Thermostat on Lounge Wall -->
                    <g id="nest-thermostat-display" transform="translate(380, 470)">
                        <!-- Outer ring (metallic finish) -->
                        <circle cx="0" cy="0" r="45" fill="url(#nestMetalGradient)" stroke="#B8B8B8" stroke-width="2"/>

                        <!-- Inner display background -->
                        <circle id="nest-display-bg" cx="0" cy="0" r="38" fill="#000000"/>

                        <!-- Current temperature (large center) -->
                        <text id="nest-current-temp" x="0" y="8" text-anchor="middle"
                              font-size="28" font-weight="700" font-family="Arial, sans-serif"
                              fill="#FFFFFF">--</text>

                        <!-- Target temperature indicator (small, top) -->
                        <text id="nest-target-temp" x="0" y="-20" text-anchor="middle"
                              font-size="10" font-family="Arial, sans-serif"
                              fill="#888888">--</text>

                        <!-- Status text (bottom) -->
                        <text id="nest-status-text" x="0" y="28" text-anchor="middle"
                              font-size="8" font-family="Arial, sans-serif"
                              fill="#666666">OFF</text>

                        <!-- Heating/cooling indicator ring -->
                        <circle id="nest-status-ring" cx="0" cy="0" r="40"
                                fill="none" stroke="transparent" stroke-width="3" opacity="0.6"/>
                    </g>

                    <!-- Kitchen -->
                    <rect x="500" y="350" width="200" height="250" fill="rgba(255,179,71,0.5)" stroke="#CC9933" stroke-width="4"/>
                    <text x="600" y="380" text-anchor="middle" font-size="16" font-weight="700" font-family="Fredoka" fill="#8B4513">Kitchen</text>

                    <!-- Extension (right) -->
                    <rect x="700" y="350" width="200" height="250" fill="rgba(152,216,200,0.5)" stroke="#CC9933" stroke-width="4"/>
                    <text x="800" y="380" text-anchor="middle" font-size="16" font-weight="700" font-family="Fredoka" fill="#8B4513">Extension</text>
                </g>

                <!-- Thermometers will be dynamically added here by JavaScript -->
                <g id="thermometers-container"></g>

                <!-- Light indicators will be dynamically added here by JavaScript -->
                <g id="light-indicators-container"></g>

                <!-- Sonos Controls (dynamically generated) -->
                <g id="sonos-controls-container"></g>

                <!-- SHIELD TV Controls (dynamically generated) -->
                <g id="shield-controls-container"></g>

                <!-- Light Effects Jukebox - Extension Room -->
                <g id="jukebox" transform="translate(800, 500)">
                    <!-- Jukebox Body -->
                    <defs>
                        <linearGradient id="jukeboxGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#FFA500;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FF8C00;stop-opacity:1" />
                        </linearGradient>
                        <radialGradient id="screenGlow" cx="50%" cy="50%">
                            <stop offset="0%" style="stop-color:#00FFFF;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#0080FF;stop-opacity:1" />
                        </radialGradient>
                    </defs>

                    <!-- Main body -->
                    <rect x="-50" y="-70" width="100" height="120" rx="10" fill="url(#jukeboxGradient)" stroke="#8B4513" stroke-width="3"/>

                    <!-- Screen -->
                    <rect x="-40" y="-60" width="80" height="35" rx="5" fill="url(#screenGlow)" stroke="#000" stroke-width="2"/>
                    <text x="0" y="-40" text-anchor="middle" fill="#FFF" font-size="8" font-weight="bold">LIGHT EFFECTS</text>
                    <text x="0" y="-30" text-anchor="middle" fill="#FFD700" font-size="6">‚ñ≤ ‚ñº Select Effect</text>

                    <!-- Effect Buttons -->
                    <g id="jukebox-btn-1" class="jukebox-button" transform="translate(-30, -10)" style="cursor: pointer;">
                        <circle r="8" fill="#FF0000" stroke="#8B0000" stroke-width="1.5"/>
                        <text x="0" y="3" text-anchor="middle" fill="#FFF" font-size="10">üö®</text>
                        <text x="0" y="15" text-anchor="middle" fill="#333" font-size="5">Red Alert</text>
                    </g>

                    <g id="jukebox-btn-2" class="jukebox-button" transform="translate(0, -10)" style="cursor: pointer;">
                        <circle r="8" fill="#FF00FF" stroke="#8B008B" stroke-width="1.5"/>
                        <text x="0" y="3" text-anchor="middle" fill="#FFF" font-size="10">üéâ</text>
                        <text x="0" y="15" text-anchor="middle" fill="#333" font-size="5">Party</text>
                    </g>

                    <g id="jukebox-btn-3" class="jukebox-button" transform="translate(30, -10)" style="cursor: pointer;">
                        <circle r="8" fill="#FFD700" stroke="#B8860B" stroke-width="1.5"/>
                        <text x="0" y="3" text-anchor="middle" fill="#FFF" font-size="10">üï∫</text>
                        <text x="0" y="15" text-anchor="middle" fill="#333" font-size="5">Disco</text>
                    </g>

                    <g id="jukebox-btn-4" class="jukebox-button" transform="translate(-15, 15)" style="cursor: pointer;">
                        <circle r="8" fill="#4169E1" stroke="#191970" stroke-width="1.5"/>
                        <text x="0" y="3" text-anchor="middle" fill="#FFF" font-size="10">üåä</text>
                        <text x="0" y="15" text-anchor="middle" fill="#333" font-size="5">Wave</text>
                    </g>

                    <g id="jukebox-btn-5" class="jukebox-button" transform="translate(15, 15)" style="cursor: pointer;">
                        <circle r="8" fill="#FF6B35" stroke="#8B3A1E" stroke-width="1.5"/>
                        <text x="0" y="3" text-anchor="middle" fill="#FFF" font-size="10">üåÖ</text>
                        <text x="0" y="15" text-anchor="middle" fill="#333" font-size="5">Sunset</text>
                    </g>

                    <!-- Decorative lights -->
                    <circle cx="-35" cy="-70" r="3" fill="#FF0000" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="1s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="35" cy="-70" r="3" fill="#00FF00" opacity="0.8">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="1s" repeatCount="indefinite"/>
                    </circle>
                </g>

                <!-- Tapo Smart Plug Controls (dynamically generated) -->
                <g id="tapo-plugs-container"></g>

                <!-- Motion indicators will be dynamically added here by JavaScript -->
                <g id="motion-indicators-container"></g>

                <!-- Outdoor area (OUTSIDE the house) -->
                <g id="outdoor-area" transform="translate(30, 420)">
                    <!-- Tree -->
                    <rect x="10" y="70" width="20" height="90" rx="5" fill="#8B4513"/>
                    <circle cx="20" cy="60" r="45" fill="#2ECC71" opacity="0.8"/>
                    <circle cx="8" cy="45" r="38" fill="#27AE60" opacity="0.8"/>
                    <circle cx="32" cy="45" r="38" fill="#27AE60" opacity="0.8"/>

                    <!-- Narnia-style Lamppost -->
                    <g id="outdoor-lamppost">
                        <!-- Base -->
                        <rect x="140" y="140" width="30" height="8" fill="#2C3E50" rx="2"/>
                        <rect x="145" y="148" width="20" height="8" fill="#34495E" rx="1"/>

                        <!-- Post -->
                        <rect x="150" y="65" width="10" height="83" fill="#34495E" rx="2"/>
                        <rect x="148" y="65" width="14" height="4" fill="#2C3E50"/>

                        <!-- Ornate top piece -->
                        <rect x="148" y="50" width="14" height="15" fill="#2C3E50" rx="1"/>

                        <!-- Lamp housing (glass panels) -->
                        <g id="lamp-housing">
                            <!-- Top -->
                            <polygon points="155,35 165,50 145,50" fill="#8B4513"/>

                            <!-- Glass panels (will change based on on/off) -->
                            <rect x="148" y="50" width="4" height="12" fill="#1a1a1a" opacity="0.3" id="lamp-panel-1"/>
                            <rect x="158" y="50" width="4" height="12" fill="#1a1a1a" opacity="0.3" id="lamp-panel-2"/>
                            <rect x="150" y="50" width="10" height="12" fill="#1a1a1a" opacity="0.2" id="lamp-panel-center"/>

                            <!-- Light bulb inside (will glow when on) -->
                            <circle cx="155" cy="56" r="6" fill="#666" id="lamp-bulb"/>

                            <!-- Frame lines -->
                            <rect x="148" y="50" width="14" height="12" fill="none" stroke="#2C3E50" stroke-width="1.5"/>
                            <line x1="152" y1="50" x2="152" y2="62" stroke="#2C3E50" stroke-width="1"/>
                            <line x1="158" y1="50" x2="158" y2="62" stroke="#2C3E50" stroke-width="1"/>
                        </g>

                        <!-- Decorative scrollwork -->
                        <path d="M 155 65 Q 145 68 145 73" fill="none" stroke="#2C3E50" stroke-width="1.5"/>
                        <path d="M 155 65 Q 165 68 165 73" fill="none" stroke="#2C3E50" stroke-width="1.5"/>
                    </g>

                    <!-- Outdoor thermometer will be added here by JavaScript -->
                    <g id="outdoor-thermometer-container"></g>
                </g>

                <!-- Flowers in garden -->
                <g transform="translate(150, 590)">
                    <circle cx="0" cy="0" r="7" fill="#FF69B4"/>
                    <circle cx="25" cy="4" r="7" fill="#FF1493"/>
                    <circle cx="50" cy="-2" r="7" fill="#FF69B4"/>
                    <rect x="-2" y="0" width="2.5" height="25" fill="#228B22"/>
                    <rect x="23" y="4" width="2.5" height="20" fill="#228B22"/>
                    <rect x="48" y="-2" width="2.5" height="27" fill="#228B22"/>
                </g>

                <g transform="translate(750, 598)">
                    <circle cx="0" cy="0" r="7" fill="#FFD700"/>
                    <circle cx="22" cy="2" r="7" fill="#FFA500"/>
                    <circle cx="44" cy="-1" r="7" fill="#FFD700"/>
                    <rect x="-2" y="0" width="2.5" height="23" fill="#228B22"/>
                    <rect x="20" y="2" width="2.5" height="20" fill="#228B22"/>
                    <rect x="42" y="-1" width="2.5" height="25" fill="#228B22"/>
                </g>

                <!-- Moose character container (dynamically populated) -->
                <g id="moose-container"></g>

                <!-- Color picker popup container (on top of everything) -->
                <g id="color-picker-container"></g>
            </svg>
        </div>

        <div class="stats-grid">
            <!-- Weather now displayed in sky SVG -->
        </div>

        <!-- Sensor Details Panel -->
        <div class="graph-container" style="margin-top: 20px;">
            <h2 class="graph-title section-header" onclick="toggleSection('sensor-details-content', 'sensor-arrow')">
                <span class="section-arrow collapsed" id="sensor-arrow">‚ñº</span>
                üì° Sensor Details
            </h2>
            <div id="sensor-details-content" class="collapsible-content collapsed">
                <div id="sensor-details" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; padding: 15px;">
                    <div style="text-align: center; color: #999; padding: 20px;">Loading sensor data...</div>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="graph-container" style="margin-top: 20px;">
            <h2 class="graph-title section-header" onclick="toggleSection('motion-log-content', 'motion-arrow')">
                <span class="section-arrow collapsed" id="motion-arrow">‚ñº</span>
                üìã 48-Hour Activity Log
            </h2>
            <div id="motion-log-content" class="collapsible-content collapsed">
                <div id="motion-log" style="max-height: 300px; overflow-y: auto; padding: 15px; background: #f9f9f9; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 13px;">
                    <div style="text-align: center; color: #999; padding: 20px;">Loading activity history...</div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                    <span id="motion-log-count">0</span> events in last 48 hours
                </div>
            </div>
        </div>

    </div>

    <!-- Global Configuration (must load before modules) -->
    <script src="config.js"></script>
    <script src="nest-config.js"></script>

    <!-- Shared utilities needed by non-module scripts -->
    <script src="js/config.js"></script>
    <script src="js/config/schema.js"></script>
    <script src="js/config/loader.js"></script>
    <script src="js/config/index.js"></script>
    <script src="js/config/mappings.js"></script>
    <script src="js/utils/logger.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/ui/draggable.js"></script>
    <script src="js/ui/color-picker.js"></script>

    <!-- Core Modules (infrastructure for app.js) -->
    <script src="js/core/events.js"></script>
    <script src="js/core/state.js"></script>
    <script src="js/core/connection-monitor.js"></script>
    <script src="js/core/poller.js"></script>
    <script src="js/core/initializer.js"></script>

    <!-- API Clients -->
    <script src="js/api/hue.js"></script>
    <script src="js/api/sonos.js"></script>
    <script src="js/api/tapo.js"></script>
    <script src="js/api/shield.js"></script>

    <!-- Feature Modules -->
    <script src="js/features/tapo.js"></script>
    <script src="js/features/nest.js"></script>
    <script src="js/features/sonos.js"></script>
    <script src="js/features/shield.js"></script>
    <script src="js/features/effects.js"></script>
    <script src="js/features/moose.js"></script>
    <script src="js/features/motion-indicators.js"></script>

    <!-- Main Application - NEW MODULAR VERSION -->
    <script src="js/app.js"></script>

    <!--
    ==========================================================================
    LEGACY main.js (kept for reference, can be deleted once app.js is verified)
    To revert: comment out app.js above, uncomment main.js below
    <script src="js/main.js"></script>
    ==========================================================================
    -->

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
